# =====================================================
# APPLICATION
# =====================================================
spring.application.name=cloud-gateway-service
server.port=8888

# =====================================================
# EUREKA CLIENT
# =====================================================
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/
eureka.instance.prefer-ip-address=true

# =====================================================
# GATEWAY CONFIG
# =====================================================
# Usar APENAS rotas explícitas
spring.cloud.gateway.discovery.locator.enabled=false

# =====================================================
# VEHICLES SERVICE ROUTE
# =====================================================
spring.cloud.gateway.routes[0].id=vehicles-service
spring.cloud.gateway.routes[0].uri=lb://CAR-POOLING-VEHICLES-API
spring.cloud.gateway.routes[0].predicates[0]=Path=/vehicles/**
spring.cloud.gateway.routes[0].filters[0]=StripPrefix=1
spring.cloud.gateway.routes[0].filters[1].name=CircuitBreaker
spring.cloud.gateway.routes[0].filters[1].args.name=vehiclesCircuitBreaker
spring.cloud.gateway.routes[0].filters[1].args.fallbackUri=forward:/fallback/vehicles

# =====================================================
# IDENTITY SERVICE ROUTE
# =====================================================
spring.cloud.gateway.routes[1].id=identity-service
spring.cloud.gateway.routes[1].uri=lb://CAR-POOLING-IDENTITY-API
spring.cloud.gateway.routes[1].predicates[0]=Path=/identity/**
spring.cloud.gateway.routes[1].filters[0]=StripPrefix=1
spring.cloud.gateway.routes[1].filters[1].name=CircuitBreaker
spring.cloud.gateway.routes[1].filters[1].args.name=identityCircuitBreaker
spring.cloud.gateway.routes[1].filters[1].args.fallbackUri=forward:/fallback/identity

# =====================================================
# LOGGING (DEV ONLY)
# =====================================================
logging.level.org.springframework.cloud.gateway=INFO
logging.level.org.springframework.cloud.loadbalancer=INFO

# =====================================================
# ACTUATOR
# =====================================================
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=always

# =====================================================
# RESILIENCE4J ? GLOBAL CONFIG
# =====================================================
resilience4j.circuitbreaker.configs.default.registerHealthIndicator=true
resilience4j.circuitbreaker.configs.default.slidingWindowSize=10
resilience4j.circuitbreaker.configs.default.minimumNumberOfCalls=5
resilience4j.circuitbreaker.configs.default.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.configs.default.automaticTransitionFromOpenToHalfOpenEnabled=true
resilience4j.circuitbreaker.configs.default.waitDurationInOpenState=5s
resilience4j.circuitbreaker.configs.default.failureRateThreshold=50
resilience4j.circuitbreaker.configs.default.eventConsumerBufferSize=10

resilience4j.timelimiter.configs.default.timeoutDuration=4s
